<tr class="hover:bg-gray-50">
    <td class="px-4 py-4 align-top">
        <div class="flex flex-col gap-1">
            <div class="flex items-center gap-2">
                <p class="font-semibold text-gray-900">{{ reward.title }}</p>
                {% if reward.is_featured %}
                    {% include 'components/badge.html' with text="Featured" variant="primary" %}
                {% endif %}
                {% if reward.requires_approval %}
                    {% include 'components/badge.html' with text="Needs approval" variant="info" %}
                {% endif %}
            </div>
            {% if reward.description %}
                <p class="text-sm text-gray-600">{{ reward.description|truncatechars:110 }}</p>
            {% endif %}
            {% if reward.tags %}
                <p class="text-xs text-gray-500">Tags: {{ reward.tags }}</p>
            {% endif %}
        </div>
    </td>
    <td class="px-4 py-4 text-sm text-gray-800">
        {% if reward.is_active %}
            {% include 'components/badge.html' with text="Active" variant="success" %}
        {% else %}
            {% include 'components/badge.html' with text="Inactive" variant="muted" %}
        {% endif %}
        <p class="text-xs text-gray-500 mt-1">{{ reward.get_category_display }}</p>
    </td>
    <td class="px-4 py-4 text-sm text-gray-800">
        <div class="font-semibold text-gray-900">{{ reward.point_cost }} pts</div>
        {% if reward.per_user_limit %}
            <p class="text-xs text-gray-500">Per-user: {{ reward.per_user_limit }}</p>
        {% endif %}
        {% if reward.cooldown_days %}
            <p class="text-xs text-gray-500">Cooldown: {{ reward.cooldown_days }}d</p>
        {% endif %}
    </td>
    <td class="px-4 py-4 text-sm text-gray-800">
        {% if reward.quantity_available %}
            <div class="font-semibold text-gray-900">{{ reward.quantity_remaining|default:reward.quantity_available }} / {{ reward.quantity_available }}</div>
            {% if reward.low_stock_threshold and reward.quantity_remaining and reward.quantity_remaining <= reward.low_stock_threshold %}
                {% include 'components/badge.html' with text="Low" variant="danger" %}
            {% endif %}
        {% else %}
            <span class="text-gray-700">Unlimited</span>
        {% endif %}
    </td>
    <td class="px-4 py-4 text-sm text-gray-800">
        {% if reward.available_from or reward.available_until %}
            {% if reward.available_from %}<p class="text-xs text-gray-600">From {{ reward.available_from|date:"M j, g:ia" }}</p>{% endif %}
            {% if reward.available_until %}<p class="text-xs text-gray-600">Until {{ reward.available_until|date:"M j, g:ia" }}</p>{% endif %}
        {% else %}
            <span class="text-gray-700">Always</span>
        {% endif %}
    </td>
    <td class="px-4 py-4 text-right text-sm">
        {% if mode == 'redeem' %}
            {% url 'redeem_reward' reward.id as base_redeem_url %}
            {% if selected_household %}
                {% with household_id=selected_household.id|stringformat:"s" %}
                    {% with redeem_href=base_redeem_url|add:"?household="|add:household_id %}
                        {% if reward.is_available and user_score and user_score.current_points|default:0 >= reward.point_cost %}
                            <form method="post" action="{{ redeem_href }}">
                                {% csrf_token %}
                                {% include 'components/button.html' with type="submit" label="Redeem" size="sm" %}
                            </form>
                        {% elif reward.is_available %}
                            <div class="text-xs text-gray-500 text-right">Need {{ reward.point_cost }} pts</div>
                        {% else %}
                            <div class="text-xs text-gray-500 text-right">Unavailable</div>
                        {% endif %}
                    {% endwith %}
                {% endwith %}
            {% else %}
                {% with redeem_href=base_redeem_url %}
                    {% if reward.is_available and user_score and user_score.current_points|default:0 >= reward.point_cost %}
                        <form method="post" action="{{ redeem_href }}">
                            {% csrf_token %}
                            {% include 'components/button.html' with type="submit" label="Redeem" size="sm" %}
                        </form>
                    {% elif reward.is_available %}
                        <div class="text-xs text-gray-500 text-right">Need {{ reward.point_cost }} pts</div>
                    {% else %}
                        <div class="text-xs text-gray-500 text-right">Unavailable</div>
                    {% endif %}
                {% endwith %}
            {% endif %}
        {% else %}
            {% url 'edit_reward' reward.id as base_edit_url %}
            {% if selected_household %}
                {% with household_id=selected_household.id|stringformat:"s" %}
                    {% with edit_href=base_edit_url|add:"?household="|add:household_id %}
                        {% include 'components/button.html' with href=edit_href label="Edit" variant="secondary" size="sm" %}
                    {% endwith %}
                {% endwith %}
            {% else %}
                {% include 'components/button.html' with href=base_edit_url label="Edit" variant="secondary" size="sm" %}
            {% endif %}
        {% endif %}
    </td>
</tr>
