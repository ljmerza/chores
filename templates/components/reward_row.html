{% comment %}
Reward Row - Table row for reward display

Props:
  - reward (required): Reward object
  - mode: 'redeem' for user view, else shows edit button
  - selected_household: Current household for URL building
  - user_score: User's score object (for redeem mode)
{% endcomment %}
{% load url_extras %}
<tr class="hover:bg-gray-50">
    <td class="px-4 py-4 align-top">
        <div class="flex flex-col gap-1">
            <div class="flex items-center gap-2">
                <p class="font-semibold text-gray-900">{{ reward.title }}</p>
                {% if reward.is_featured %}
                    {% include 'components/badge.html' with text="Featured" variant="primary" %}
                {% endif %}
                {% if reward.requires_approval %}
                    {% include 'components/badge.html' with text="Needs approval" variant="info" %}
                {% endif %}
            </div>
            {% if reward.description %}
                <p class="text-sm text-gray-600">{{ reward.description|truncatechars:110 }}</p>
            {% endif %}
            {% if reward.tags %}
                <p class="text-xs text-gray-500">Tags: {{ reward.tags }}</p>
            {% endif %}
        </div>
    </td>
    <td class="px-4 py-4 text-sm text-gray-800">
        {% if reward.is_active %}
            {% include 'components/badge.html' with text="Active" variant="success" %}
        {% else %}
            {% include 'components/badge.html' with text="Inactive" variant="muted" %}
        {% endif %}
        <p class="text-xs text-gray-500 mt-1">{{ reward.get_category_display }}</p>
    </td>
    <td class="px-4 py-4 text-sm text-gray-800">
        <div class="font-semibold text-gray-900">{{ reward.point_cost }} pts</div>
        {% if reward.per_user_limit %}
            <p class="text-xs text-gray-500">Per-user: {{ reward.per_user_limit }}</p>
        {% endif %}
        {% if reward.cooldown_days %}
            <p class="text-xs text-gray-500">Cooldown: {{ reward.cooldown_days }}d</p>
        {% endif %}
    </td>
    <td class="px-4 py-4 text-sm text-gray-800">
        {% if reward.quantity_available %}
            <div class="font-semibold text-gray-900">{{ reward.quantity_remaining|default:reward.quantity_available }} / {{ reward.quantity_available }}</div>
            {% if reward.low_stock_threshold and reward.quantity_remaining and reward.quantity_remaining <= reward.low_stock_threshold %}
                {% include 'components/badge.html' with text="Low" variant="danger" %}
            {% endif %}
        {% else %}
            <span class="text-gray-700">Unlimited</span>
        {% endif %}
    </td>
    <td class="px-4 py-4 text-sm text-gray-800">
        {% if reward.available_from or reward.available_until %}
            {% if reward.available_from %}<p class="text-xs text-gray-600">From {{ reward.available_from|date:"M j, g:ia" }}</p>{% endif %}
            {% if reward.available_until %}<p class="text-xs text-gray-600">Until {{ reward.available_until|date:"M j, g:ia" }}</p>{% endif %}
        {% else %}
            <span class="text-gray-700">Always</span>
        {% endif %}
    </td>
    <td class="px-4 py-4 text-right text-sm">
        {% if mode == 'redeem' %}
            {% url_with 'redeem_reward' reward.id household=selected_household.id as redeem_href %}
            {% if reward.is_available and user_score and user_score.current_points|default:0 >= reward.point_cost %}
                <form method="post" action="{{ redeem_href }}">
                    {% csrf_token %}
                    {% include 'components/button.html' with type="submit" label="Redeem" size="sm" %}
                </form>
            {% elif reward.is_available %}
                <div class="text-xs text-gray-500 text-right">Need {{ reward.point_cost }} pts</div>
            {% else %}
                <div class="text-xs text-gray-500 text-right">Unavailable</div>
            {% endif %}
        {% else %}
            {% url_with 'edit_reward' reward.id household=selected_household.id as edit_href %}
            {% include 'components/button.html' with href=edit_href label="Edit" variant="secondary" size="sm" %}
        {% endif %}
    </td>
</tr>
